
Cypress.on('uncaught:exception', (err, runnable) => {
  // returning false here prevents Cypress from failing the test
  return false;
});

describe("Generated: RBAC Action Visibility", { tags: ["@integrity", "@security"] }, () => {
    const cfg = {"roles":["guest","client","psw","manager","staff"],"pages":[{"key":"ADMIN_DASHBOARD","path":"/dashboard","allowedRoles":["staff","manager"],"components":["page.container","page.header","page.title","nav.main","stats-cards"],"actions":[{"key":"btn.quickUsers","target":"/users","type":"route"},{"key":"btn.quickSchedule","target":"/schedule","type":"route"},{"key":"btn.quickLeads","target":"/leads","type":"route"}]},{"key":"USER_LIST","path":"/users","allowedRoles":["staff"],"components":["page.container","page.title","tbl.users","btn.user.invite"],"actions":[{"key":"btn.inviteUser","endpoint":"/users/invite","type":"api","method":"POST"}]},{"key":"SCHEDULE","path":"/schedule","allowedRoles":["staff","manager"],"components":["page.container","page.title","calendar-container"],"actions":[{"key":"btn.createShift","endpoint":"/shifts","type":"api","method":"POST"}]},{"key":"LEADS","path":"/leads","allowedRoles":["staff","manager"],"components":["page.container","page.title","tbl.leads"],"actions":[{"key":"btn.createLead","endpoint":"/leads","type":"api","method":"POST"}]},{"key":"SETTINGS","path":"/settings","allowedRoles":["staff"],"components":["page.container","page.title","form.settings"],"actions":[{"key":"btn.saveSettings","endpoint":"/settings","type":"api","method":"PATCH","integrity":"guard.unsaved"}]},{"key":"MANAGER_DASHBOARD","path":"/manager/dashboard","allowedRoles":["manager"],"components":["page.container","page.title","mgr-dashboard"],"actions":[{"key":"btn.dailyEntry","target":"/manager/daily-entry","type":"route"}]},{"key":"MANAGER_DAILY_ENTRY","path":"/manager/daily-entry","allowedRoles":["manager"],"components":["page.container","page.title","page.header"],"actions":[{"key":"btn.submitFinal","endpoint":"/daily-entry/submit","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"PSW_SHIFTS","path":"/shifts","allowedRoles":["psw"],"components":["page.container","page.title","tbl.shift-history"],"actions":[]},{"key":"CLIENT_BOOKINGS","path":"/bookings","allowedRoles":["client"],"components":["page.container","page.title","tbl.bookings"],"actions":[{"key":"btn.requestBooking","endpoint":"/bookings","type":"api","method":"POST"}]},{"key":"PROFILE","path":"/profile","allowedRoles":["staff","manager","psw","client"],"components":["page.container","page.title","page.header"],"actions":[{"key":"btn.saveProfile","endpoint":"/profile","type":"api","method":"PATCH","integrity":"guard.unsaved"}]},{"key":"HOME","path":"/","baseUrlEnv":"MARKETING_BASE_URL","allowedRoles":["guest","any"],"components":["page.container","hero","ctaBookNow"],"actions":[{"key":"btn.bookNow","target":"/book-now","type":"route"},{"key":"btn.viewServices","target":"/services","type":"route"}]},{"key":"INCIDENT_ENTRY","path":"/incidents/new","allowedRoles":["staff","manager"],"components":["page.container","page.header","page.title"],"actions":[{"key":"form.incident.save","endpoint":"/incidents","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"TIMESHEET_ADJ","path":"/timesheets/adjust","allowedRoles":["staff"],"components":["page.container","page.header","page.title"],"actions":[{"key":"form.timesheet.save","endpoint":"/timesheets/adjust","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"LEAD_ENTRY","path":"/leads/new","allowedRoles":["staff","manager"],"components":["page.container","page.header","page.title"],"actions":[{"key":"form.lead.save","endpoint":"/leads","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"ROLE_EDITOR","path":"/settings/roles","allowedRoles":["staff"],"components":["page.container","page.title"],"actions":[{"key":"form.role.save","endpoint":"/admin/roles/permissions","type":"api","method":"PATCH","integrity":"guard.unsaved"}]},{"key":"TEMPLATE_EDITOR","path":"/settings/templates","allowedRoles":["staff"],"components":["page.container","page.title"],"actions":[{"key":"form.template.save","endpoint":"/admin/templates","type":"api","method":"PATCH","integrity":"guard.unsaved"}]},{"key":"INVOICE_ENTRY","path":"/invoices/new","allowedRoles":["staff"],"components":["page.container","page.title"],"actions":[{"key":"form.invoice.save","endpoint":"/invoices","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"VISIT_COMPLETION","path":"/visits/complete","allowedRoles":["psw"],"components":["page.container","page.title"],"actions":[{"key":"form.visitComplete.save","endpoint":"/visits/complete","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"BOOKING_REQUEST","path":"/bookings/new","allowedRoles":["client"],"components":["page.container","page.title"],"actions":[{"key":"form.booking.save","endpoint":"/bookings","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"SUPPORT_TICKET","path":"/support/tickets/new","allowedRoles":["staff","manager","psw","client"],"components":["page.container","page.title"],"actions":[{"key":"form.supportTicket.save","endpoint":"/support/tickets","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"SHIFT_CONFIRMATION","path":"/shifts/confirm","allowedRoles":["psw"],"components":["page.container","page.title"],"actions":[{"key":"btn.shift.accept","endpoint":"/shifts/confirm","type":"api","method":"POST"}]},{"key":"EVALUATION_FORM","path":"/manager/evaluations/new","allowedRoles":["manager"],"components":["page.container","page.header","page.title"],"actions":[{"key":"form.evaluation.save","endpoint":"/evaluations","type":"api","method":"POST","integrity":"guard.unsaved"}]},{"key":"USER_ENTRY","path":"/users/new","allowedRoles":["staff"],"components":["page.container","page.header","page.title"],"actions":[{"key":"form.user.save","endpoint":"/users","type":"api","method":"POST","integrity":"guard.unsaved"}]}],"globalComponents":["nav.main","toast.success","toast.error","state.loading"],"integrityRules":{"form":["guard.unsaved.dialog","guard.unsaved.leave","guard.unsaved.stay"]}};
    const roles = cfg.roles;

    cfg.pages.forEach((page: any) => {
        roles.forEach((role: string) => {
            it(`[${page.key}] verifies visibility for role: ${role}`, () => {
                const allowed = page.allowedRoles.includes(role) || page.allowedRoles.includes("any");
                
                cy.clearCookies();
                cy.clearLocalStorage();
                if (role !== "guest") cy.loginAs(role as any);
                
                const baseUrlEnv = page.baseUrlEnv || "ADMIN_BASE_URL";
                cy.visitRoute(baseUrlEnv, page.path, { failOnStatusCode: false });

                if (!allowed) {
                    cy.url().should("not.include", page.path);
                } else {
                    page.actions.forEach((action: any) => {
                        cy.getByCy(action.key).should("be.visible");
                    });
                }
            });
        });
    });
});
